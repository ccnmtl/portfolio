{% extends 'base.html' %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load wagtailuserbar %}

{% block title %}{{page.title}}{% endblock %}

{% block entry_published_og %}
<meta property="article:published_time" content="{{page.first_published_at|date:"Y-m-d"}}" />
<meta property="article:modified_time" content="{{page.last_published_at|date:"Y-m-d"}}" />
{% endblock %}

{% block entry_jsonld %}
    <!-- JSON Structured data: Entry/Article specific -->
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "name": "{{page.title}} -- CTL Portfolio",
        "description": "{{page.search_description}}",
        "url": "url",
        "mainEntityOfPage": "url",
        "headline": "{{page.title}}",
        "datePublished": "{{page.first_published_at|date:"Y-m-d"}}",
        "dateModified": "{{page.last_published_at|date:"Y-m-d"}}",
        "dateCreated": "CCYY-MM-DD",
        "author": "Center for Teaching and Learning at Columbia University",
        "publisher": {
            "@type": "EducationalOrganization",
            "url": "https://ctl.columbia.edu",
            "name": "Center for Teaching and Learning at Columbia University",
            "logo": {
                "@type": "ImageObject",
                "url": "{{STATIC_URL}}img/logo-ctl-color.png"
            }
        }
        "image": {
            "@type": "ImageObject",
            "representativeOfPage": "True",
        {% if page.thumbnail %}
            "url": "{{ entry_thumbnail.url }}"
        {% else %}
            "url": "{{STATIC_URL}}img/og_ctlportfolio.png"
        {% endif %}
        }
    }
    </script>
{% endblock %}

{% block content %}

{% wagtailuserbar %}

<article class="entry">
    <header class="entry-header">
        <figure class="entry-header--poster">
            {% image page.poster fill-1140x526-c100 as project_poster %}
            <img src="{{project_poster.url}}" class="img-fluid" alt="Poster image for {{page.title}}">
        </figure>
        <div class="entry-header--text">
            <h1>{{page.title}}</h1>
            <section class="entry-header--partners">
                {% with partners=page.partners.all %}
                    {% if partners %}
                    <dl class="text-center m-0">
                        <dt class="field-label">
                        Partner{{ partners|pluralize }}
                        </dt>
                        <dd>
                            {% for partner in partners %}
                                {{ partner.name }},
                                {{ partner.short_title }},
                                {{ partner.affiliation }}{% if not forloop.last %}<br />{% endif %}
                            {% endfor %}
                        </dd>
                    </dl>
                    {% endif %}
                {% endwith %}
            </section>
        </div>
    </header>

    <section class="entry-section entry-section__metadata row">
        <div class="col-5 py-2 px-0">
            {% with disciplines=page.discipline.all %}
            {% if disciplines %}
            <dl class="d-flex flex-row m-0">
                <dt class="pr-2 my-0">Discipline{{ disciplines|pluralize }}:</dt>
                {% for discipline in disciplines %}
                <dd class="pr-1 my-0">{{ discipline.name }}{% if not forloop.last %},{% endif %}</dd>
                {% endfor %}
            </dl>
            {% endif %}
            {% endwith %}

            {% with award_types=page.award_type.all %}
            {% if award_types %}
            <dl class="d-flex flex-row m-0">
                <dt class="pr-2 my-0">Provost Grant:</dt>
                {% for award_type in award_types %}
                <dd class="pr-1 my-0">{{ award_type.name }}{% if not forloop.last %}, {% endif %}</dd>
                {% endfor %}
            </dl>
            {% endif %}
            {% endwith %}
        </div>
        <div class="col-4 py-2 px-0">
             <dl class="d-flex flex-row m-0">
                <dt class="pr-2 my-0">Released:</dt>
                <dd class="pr-1 my-0">{{page.release_date|date:"F Y"}}</dd>
            </dl>
             <dl class="d-flex flex-row m-0">
                <dt class="pr-2 my-0">Updated:</dt>
                <dd class="pr-1 my-0">{{page.revision_date|date:"F Y"}}</dd>
            </dl>
        </div>
        <div class="col-3 text-nowrap py-2 px-0">
            {% if page.project_url %}
                <a href="{{ page.project_url }}" target="_blank">
                Visit the site
                <i class="fa fa-external-link" aria-hidden="true"></i>
                </a>
            {% endif %}
            {% if page.infosheet %}
                | <a href="{{ page.infosheet.url }}" target="_blank">
                Infosheet 
                <i class="fa fa-download" aria-hidden="true"></i>
                </a>
            {% endif %}
            <div class="share-widget">
                <span class="field-label">Share:</span>
                <a rel="nofollow noopener noreferrer" class="share-window" href="http://www.facebook.com/share.php?u={{ page.full_url }}&title={{ page.title }}" aria-label="Share on Facebook"><i class="fa fa-facebook px-1" aria-hidden="true"></i></a>
                <a rel="nofollow noopener noreferrer" class="share-window" href="https://twitter.com/intent/tweet?text={{ page.title }}&url={{ page.full_url }}&via=ColumbiaCTL" aria-label="Share on Twitter"><i class="fa fa-twitter px-1" aria-hidden="true"></i></a>
                <a rel="nofollow noopener noreferrer" class="share-window" href="https://www.linkedin.com/shareArticle?mini=true&url={{ page.full_url }}&title={{ page.title }}&summary={{page.search_description}}"><i class="fa fa-google-plus px-1" aria-label="Share on LinkedIn"></i></a>
            </div>
        </div>
    </section>

    {% if page.overview %}
    <section class="entry-section overview">
    <p>{{page.overview}}</p>            

    </section>
    {% endif %}

    <section class="entry-section">
    {{page.description|richtext}}
    </section>

    {% if page.youtube_video_url %}
        <section class="entry-section promotional-video">
            <div class="video-player embed-responsive embed-responsive-16by9 d-print-none">
                <iframe src='{{page.youtube_video_url}}' 
                    title='{{page.video_title}}'
                    allowfullscreen
                    frameborder="0"
                    class="embed-responsive-item">
                </iframe>
            </div>
            <p class="video-attr d-print-none"> Source: Columbia University</p>
            <div class="d-none d-print-block print-alert">
                <p>
                    This segment of the page contains a video, “{{page.video_title}}”.
                    The link to this video  is:<br />
                    {{page.video_url}}
                </p>
                <p class="video-attr"> Source: Columbia University</p>
            </div>
        </section>
    {% else %}{% if page.video_url %}
        <section class="promotional-video mb-5">
            <dt class="field-label">
                Video
            </dt>
            <dd>
                <a title="{{page.video_title}}" href="{{page.video_url}}">{{page.video_title}}</a>
            </dd>
        </section>
    {% endif %}{% endif %}

        {% with partners=page.partners.all %}
            {% if partners %}
            <section class="entry-section">
                <h2>Partner{{ partners|pluralize }}</h2>
                {% for partner in partners %}
                    <div class="d-flex mb-4">
                        <div class="img-avatar">
                        {% if partner.headshot %}
                            {% image partner.headshot fill-200x200-c50 as partner_avatar %}
                            <img src="{{partner_avatar.url}}" class="img-avatar__image" alt="Poster image for {{partner.name}}">
                        {% else %}
                            <img src="{{STATIC_URL}}img/headshot-none.png" class="img-avatar__image" alt="">
                        {% endif %}
                        </div>
                        <div class="partner-info">
                            <div class="partner_name">{{ partner.name }}</div>
                            {% if partner.full_title %}
                                {{ partner.full_title }}<br />
                            {% else %}
                                {{ partner.short_title }}<br />
                            {% endif %}
                        {{ partner.affiliation }}
                        </div>
                    </div>
                {% endfor %}
            </section>
            {% endif %}
        {% endwith %}
</article>

{% endblock %}
{% block js %}
<script src="{{STATIC_URL}}js/socmedia.js"></script>
{% endblock %}